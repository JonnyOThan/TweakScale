// since attachnode sizes are integers, we need to do something about half-size attach nodes in order to support the "match node size" feature
// For those parts, the tweakscale module can directly specify what the diameter of the attach node is

// set the default node diameter for the non-integer node sizes

@PART:HAS[~tweakscale_ignore&~tweakscale_node_diameter&#tweakscale_node_size[1.5]&#tweakscale_default_scale&@MODULE[TweakScale]:HAS[#type[stack*]&!ATTACHNODEDIAMETER]]:LAST[TweakScale]
{
	tweakscale_node_diameter = #$/tweakscale_default_scale$
}

// create the ATTACHNODEDIAMETER node if it doesn't exist

@PART:HAS[~tweakscale_ignore&#tweakscale_node_diameter&@MODULE[TweakScale]:HAS[!ATTACHNODEDIAMETER]]:LAST[TweakScale]
{
	@MODULE[TweakScale]
	{
		ATTACHNODEDIAMETER
		{
		}
	}
}

// now apply the node diameter to the top and bottom nodes

@PART:HAS[~tweakscale_ignore&#tweakscale_node_diameter&#node_stack_top&@MODULE[TweakScale]:HAS[@ATTACHNODEDIAMETER:HAS[~top]]]:LAST[TweakScale]
{
	@MODULE[TweakScale]
	{
		@ATTACHNODEDIAMETER
		{
			top = #$/tweakscale_node_diameter$
		}
	}
}

@PART:HAS[~tweakscale_ignore&#tweakscale_node_diameter&#node_stack_bottom&@MODULE[TweakScale]:HAS[@ATTACHNODEDIAMETER:HAS[~bottom]]]:LAST[TweakScale]
{
	@MODULE[TweakScale]
	{
		@ATTACHNODEDIAMETER
		{
			bottom = #$/tweakscale_node_diameter$
		}
	}
}